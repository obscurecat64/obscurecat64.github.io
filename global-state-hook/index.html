<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.24.4"/><meta data-react-helmet="true" name="description" content="My goal was to have 12 posts by the end of the year (a post a month) but obviously I haven’t been posting in a long time 😅. But there’s still some time left…"/><meta data-react-helmet="true" property="og:title" content="A global state hook"/><meta data-react-helmet="true" property="og:description" content="My goal was to have 12 posts by the end of the year (a post a month) but obviously I haven’t been posting in a long time 😅. But there’s still some time left…"/><meta data-react-helmet="true" property="og:type" content="website"/><style data-href="/obscurecat64.github.io/styles.577035927862b072c933.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/obscurecat64.github.io/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/obscurecat64.github.io/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/obscurecat64.github.io/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/obscurecat64.github.io/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/obscurecat64.github.io/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/obscurecat64.github.io/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/obscurecat64.github.io/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/obscurecat64.github.io/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/obscurecat64.github.io/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/obscurecat64.github.io/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/obscurecat64.github.io/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/obscurecat64.github.io/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/obscurecat64.github.io/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/obscurecat64.github.io/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/obscurecat64.github.io/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/obscurecat64.github.io/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/obscurecat64.github.io/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/obscurecat64.github.io/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/obscurecat64.github.io/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/obscurecat64.github.io/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/obscurecat64.github.io/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/obscurecat64.github.io/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/obscurecat64.github.io/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/obscurecat64.github.io/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/obscurecat64.github.io/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/obscurecat64.github.io/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/obscurecat64.github.io/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/obscurecat64.github.io/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6);font-weight:var(--fontWeight-black)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0)}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}@media (max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4)}ol,ul{list-style-position:inside}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.index-module--post-list-item--cad2d{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.index-module--post-list-item--cad2d p{margin-bottom:var(--spacing-0)}.index-module--post-list-item--cad2d h2{color:var(--color-primary);font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.index-module--post-list-item--cad2d header{margin-bottom:var(--spacing-4)}.index-module--post-list-item--cad2d small{margin-right:8px}.index-module--post-list-item--cad2d small>span{border:1px solid #b7eb8f;border-radius:4px;color:#389e0d;cursor:default;margin:0 4px;padding:0 4px}.bio-module--bio--7c31e{align-items:center;display:flex;margin-bottom:var(--spacing-16)}.bio-module--bio--7c31e p{margin-bottom:var(--spacing-0)}.bio-module--bio-avatar--6a8a1{border-radius:9999px;margin-bottom:var(--spacing-0);margin-right:var(--spacing-4);min-width:50px}.layout-module--layout--6bf3d{margin:auto;max-width:var(--maxWidth-wrapper);padding:var(--spacing-10) var(--spacing-5)}.layout-module--layout--6bf3d header{margin-bottom:var(--spacing-12)}.layout-module--main-heading--83d50{font-size:var(--fontSize-7);margin:0}.layout-module--header-link-home--f69e0{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.tag-module--tag--d6823{border-radius:4px;cursor:default;font-family:initial;font-size:12px;margin:0 4px;padding:0 4px}.blog-post-module--blog-post--59946 header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post-module--blog-post--59946 header p{font-family:var(--font-heading);font-size:var(--fontSize-2);margin:0}.blog-post-module--blog-post-nav--6c6d8 ul{margin:var(--spacing-0)}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" title="Wai Thoughts RSS Feed" href="/obscurecat64.github.io/rss.xml"/><link rel="icon" href="/obscurecat64.github.io/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/obscurecat64.github.io/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/obscurecat64.github.io/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/obscurecat64.github.io/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/obscurecat64.github.io/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/obscurecat64.github.io/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/obscurecat64.github.io/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/obscurecat64.github.io/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/obscurecat64.github.io/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/obscurecat64.github.io/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">A global state hook | Wai Thoughts</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--layout--6bf3d"><header><a class="layout-module--header-link-home--f69e0" href="/obscurecat64.github.io/">Wai Thoughts</a></header><main><article class="blog-post-module--blog-post--59946" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">A global state hook</h1><p>August 28, 2022</p><div><span class="tag-module--tag--d6823" style="border:1px solid #adc6ff;color:#1d39c4;background-color:rgb(240, 245, 255)">tech</span><span class="tag-module--tag--d6823" style="border:1px solid #ffadd2;color:#c41d7f;background-color:rgb(255, 240, 246)">react</span></div></header><section itemProp="articleBody"><p>My goal was to have 12 posts by the end of the year (a post a month) but obviously I haven’t been posting in a long time 😅. But there’s still some time left, and I’ll make up for it in the remaining months!</p>
<p>For this post I’d like to share about how to write a simple global state hook. Using the hook would look something like:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">// createGlobalHook is a function that creates a react hook
const useGlobalCount = createGlobalHook(0)
const useGlobalFlag = createGlobalHook(false)

const MyComponentA = () => {
  // component has access to the states via their respective hooks
  const [globalCount, setGlobalCount] = useGlobalCount()
  const [globalFlag, setGlobalFlag] = useGlobalFlag()

  // ...
}</code></pre></div>
<p>I first saw the idea of such a global state hook while reading through code at work, and while doing some research I found <a href="https://github.com/dai-shi/react-hooks-global-state" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">react-hooks-global-state</code></a> and then <a href="https://github.com/pmndrs/zustand" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">zustand</code></a> that uses this same idea. <code class="language-text">react-hooks-global-state</code> is actually implemented with <code class="language-text">zustand</code> now (both libraries are written by the same author), and would I recommend you try out <code class="language-text">zustand</code> if you’re interested in such a hook. It deals with more complicated stuffs like React concurrency which for this simple example hook I will not delve into. Disclaimer: I haven’t gotten to using <code class="language-text">zustand</code> just yet (I will soon)!</p>
<p>Now let’s look at how we could implement a simplified version of such a hook. <code class="language-text">createGlobalHook</code> is a function that accepts an initial state and returns a custom react hook. In it, we need to maintain state which is our new global state. Whenever our global state is updated, we need to inform components that use this state to rerender so as to use the updated state.</p>
<p>Firstly, in <code class="language-text">createGlobalHook</code> we initialise a variable <code class="language-text">state</code> to <code class="language-text">initialState</code> and create an initially empty array of <code class="language-text">listeners</code>.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const createGlobalHook = (initialState) => {
  let state = initialState
  const listeners = []

  // ...
}</code></pre></div>
<p>Then, we start writing our custom hook <code class="language-text">useGlobalState</code>. In <code class="language-text">useGlobalState</code>, we will use React’s built-in <code class="language-text">useState</code> hook for its <code class="language-text">setState</code> function. We talked about how we need to inform components to rerender when the state is changed, and by using <code class="language-text">setState</code> React will rerender the component when <code class="language-text">setState</code> is called with a new state. To do so, we add a new listener to <code class="language-text">listeners</code> when the component is mounted to inform the component to rerender when state changes. When the component is unmounted, we unsubscribe it as a listener.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const createGlobalHook = (initialState) => {
  let state = initialState
  const listeners = []

  const useGlobalState = () = {
    const [, setState] = useState(state)

    useEffect(() => {
      const listener = () => setState(state)
      listeners.push(listener)

      // remove listener from listeners when component unmounts
      return () => listeners.splice(listeners.indexOf(listener), 1)
    }, [])

    // ...
  }

  return useGlobalState
}
</code></pre></div>
<p>We need to have a custom <code class="language-text">setGlobalState</code> function that updates the global state. When doing so, we get the current and other components to rerender by going through our <code class="language-text">listeners</code>. We wrap <code class="language-text">setGlobalState</code> in a <code class="language-text">useCallback</code> to ensure that it is stable across rerenders, just like <code class="language-text">setState</code> from the <code class="language-text">useState</code> hook. Lastly, we return <code class="language-text">state</code> (which is our global state) and <code class="language-text">setGlobalState</code> just like the <code class="language-text">useState</code> hook.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const createGlobalHook = (initialState) => {
  let state = initialState
  const listeners = []

  const useGlobalState = () = {
    const [, setState] = useState(state)

    useEffect(() => {
      const listener = () => setState(state)
      listeners.push(listener)

      // remove listener from listeners when component unmounts
      return () => listeners.splice(listeners.indexOf(listener), 1)
    }, [])

    const setGlobalState = useCallback((newState) => {
      state = newState
      setState(newState)
      listeners.forEach((listener) => listener())
    }, [])

    return [state, setGlobalState]
  }

  return useGlobalState
}
</code></pre></div>
<p>Now let’s run through what happens when a component uses <code class="language-text">createGlobalHook</code> and its returned hook:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">const useGlobalCount = createGlobalHook(0)

const Counter = () => {
  const [globalCount, setGlobalCount] = useGlobalCount()

  useEffect(() => {
    console.log('Rendered')
  })

  return (
    &lt;div>
      &lt;button onClick={() => setGlobalCount(globalCount + 1)}>Click me&lt;/button>
      count: {globalCount}
    &lt;/div>
  )
}

const App = () => {
  return (
    &lt;div>
      &lt;Counter />
      &lt;Counter />
    &lt;/div>
  )
}</code></pre></div>
<p><code class="language-text">createGlobalHook</code> is called, and an initial state is initialised with a value of 0. The returned hook <code class="language-text">useGlobalCount</code> is used in the <code class="language-text">Counter</code> component.</p>
<p>We create a <code class="language-text">useGlobalCount</code> hook using <code class="language-text">createGlobalHook</code>. Now in the <code class="language-text">Counter</code> component, we use our new <code class="language-text">useGlobalCount</code> hook. The component will show the value of <code class="language-text">globalCount</code>, as well as call <code class="language-text">setGlobalCount</code> to increment its value when the button is clicked.</p>
<p>When <code class="language-text">App</code> is rendered, so are our 2 <code class="language-text">Counter</code> components. By using the <code class="language-text">useGlobalCount</code> hook, they are each registered as a listener in <code class="language-text">listeners</code>. When the button in the first <code class="language-text">Counter</code> is clicked, the global state is updated and the components that use <code class="language-text">useGlobalCount</code> are informed to rerender. Since all components that read <code class="language-text">globalCount</code> are rerendered, they will now use (and show) the updated value.</p>
<p>I created a small working example <a href="https://codesandbox.io/s/peaceful-jang-7dczdu?file=/src/createGlobalHook.js" target="_blank" rel="nofollow noopener noreferrer">here</a> if you’d like to see it in action! With Concurrent React a basic implementation like this can result in undesired behaviour such as <a href="https://stackoverflow.com/questions/54891675/what-is-tearing-in-the-context-of-the-react-redux" target="_blank" rel="nofollow noopener noreferrer">tearing</a>, and so using a global state management library that handles them for you might be more practical. Still, it’s interesting to see how things work underneath!</p>
<p>If you haven’t seen a hook like this, I hope this post was helpful to you 😄. That’s all for this post; check back again soon and see ya!</p></section><hr/><footer><div class="bio-module--bio--7c31e"><div data-gatsby-image-wrapper="" style="width:75px;height:75px" class="gatsby-image-wrapper bio-module--bio-avatar--6a8a1"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#a8c8e8;width:75px;height:75px;position:relative"></div><picture><source type="image/avif" data-srcset="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/26941/me.avif 75w,/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/95309/me.avif 150w" sizes="75px"/><source type="image/webp" data-srcset="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/a18cc/me.webp 75w,/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/7ddcc/me.webp 150w" sizes="75px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="75px" decoding="async" loading="lazy" data-src="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/d8275/me.jpg" data-srcset="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/d8275/me.jpg 75w,/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/b5649/me.jpg 150w" alt="Me"/></picture><noscript><picture><source type="image/avif" srcSet="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/26941/me.avif 75w,/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/95309/me.avif 150w" sizes="75px"/><source type="image/webp" srcSet="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/a18cc/me.webp 75w,/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/7ddcc/me.webp 150w" sizes="75px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="75px" decoding="async" loading="lazy" src="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/d8275/me.jpg" srcSet="/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/d8275/me.jpg 75w,/obscurecat64.github.io/static/ea0ba90b8a82099a9b27c61a6398c110/b5649/me.jpg 150w" alt="Me"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><p>Written by <strong>Wai Lun</strong><br/><small>Frontend developer from Singapore</small></p></div></footer></article><nav class="blog-post-module--blog-post-nav--6c6d8"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/obscurecat64.github.io/functional-components-inside-render-bad/">← <!-- -->Functional components inside render?</a></li><li><a rel="next" href="/obscurecat64.github.io/so-you-want-to-vim/">So you want to Vim<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2024<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.com">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/global-state-hook/";window.___webpackCompilationHash="6493301caf1df794358f";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-afa68794cf9a69af341a.js"],"app":["/app-b76624a1413e4102c7f4.js"],"component---src-pages-404-js":["/component---src-pages-404-js-06a5f04851a6a8ef34d7.js"],"component---src-pages-index-js":["/component---src-pages-index-js-235a7b1dd230cf57b612.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-63dd0a728cddcee48527.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-6b50865ba53118b4786e.js"]};/*]]>*/</script><script src="/obscurecat64.github.io/polyfill-afa68794cf9a69af341a.js" nomodule=""></script><script src="/obscurecat64.github.io/app-b76624a1413e4102c7f4.js" async=""></script><script src="/obscurecat64.github.io/framework-21cdc04874840f845a1f.js" async=""></script><script src="/obscurecat64.github.io/webpack-runtime-cd72bda7fdcb132d9172.js" async=""></script></body></html>